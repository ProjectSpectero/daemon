@using System
@using System.Collections.Generic
@using Spectero.daemon.Libraries.Core

@model Spectero.daemon.Libraries.Services.OpenVPN.Elements.OpenVPNUserConfig
@inherits RazorLight.TemplatePage<Spectero.daemon.Libraries.Services.OpenVPN.Elements.OpenVPNUserConfig>
@{
    DisableEncoding = true;
    var user = Model.User;
    var listeners = Model.Listeners;
    var systemId = Model.Identity;

    var convertedListeners = new List<Tuple<string, int, string>>();

    var pkcs12Header = user.Cert.Substring(0, 64);
    var pkcs12Remainder = user.Cert.Substring(64);

    foreach (var listener in listeners)
    {
        string protocolType;
        switch (listener.Protocol)
        {
            case TransportProtocols.TCP:
                protocolType = "tcp-client";
                break;
            default:
                protocolType = "udp";
                break;
        }
        convertedListeners.Add(new Tuple<string, int, string>(listener.IPAddress, listener.Port, protocolType));
    }
}
# Automatically generated OpenVPN client config file by Spectero Daemon
# Generated on @DateTime.UtcNow (UTC) by @systemId
# Note: this config file contains inline private keys
# and therefore should be kept confidential!
# Note: this configuration is user-locked to the username below
# SPECTERO_USERNAME=@user.AuthKey
# SPECTERO_INSTANCE_ID=@systemId

setenv FORWARD_COMPATIBLE 1
client
proto udp
server-poll-timeout 4
nobind
@foreach (var listener in convertedListeners)
{
    @:remote @listener.Item1 @listener.Item2 @listener.Item3
}

dev tun
dev-type tun
reneg-sec 604800
sndbuf 100000
rcvbuf 100000
max-routes 2048

# NOTE: LZO commands are pushed by the Access Server at connect time.
# NOTE: The below line doesn't disable LZO.
comp-lzo
verb 3
setenv PUSH_PEER_INFO

<pkcs12>
    @pkcs12Header
    @pkcs12Remainder
</pkcs12>

# <ca>
    #
    #
</ca>
#
# <cert>
    #
    #
</cert>
#
# <key>
    #
    #
</key>
# key-direction 1
# <tls-auth>
    #
    #
</tls-auth>

# Extra user-defined configuration
cipher AES-256-CBC